FROM node:22-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    jq \
    && rm -rf /var/lib/apt/lists/*

# Create a non-root user for running Claude Code.
# --dangerously-skip-permissions is blocked when running as root.
# node:22-slim already has a 'node' user at UID 1000, so use UID 1001.
RUN useradd -m -s /bin/bash -u 1001 sandbox \
    && mkdir -p /workspace && chown sandbox:sandbox /workspace

# Claude Code SDK is mounted as a read-only volume at /opt/claude-sdk
# from the host's node_modules at runtime â€” no install needed here.

USER sandbox
WORKDIR /workspace

# Container stays alive waiting for podman exec commands
CMD ["sleep", "infinity"]
